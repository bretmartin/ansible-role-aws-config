---

- name: list all AWS regions
  command: >
    aws ec2 describe-regions
            --query 'Regions[*].RegionName'
            --profile '{{ aws_profile }}'
  register: _aws_config_all_regions
  changed_when: False

- name: set all AWS regions fact
  set_fact:
    _aws_config_all_regions: >
      {{ _aws_config_all_regions.stdout | from_json }}

- name: set configured AWS regions fact
  set_fact:
    _aws_config_configured_regions: >
      {% if aws_config_regions == 'ALL' -%}
      {{ _aws_config_all_regions }}
      {% elif aws_config_regions == 'NONE' -%}
      {{ [] }}
      {% else -%}
      {{ aws_config_regions }}
      {% endif -%}

- name: set added and removed AWS regions fact
  set_fact:
    _aws_config_active_regions: >
      {{ _aws_config_configured_regions }}
    _aws_config_inactive_regions: >
      {{ _aws_config_all_regions | difference(_aws_config_configured_regions) }}
